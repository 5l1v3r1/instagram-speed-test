<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-firestore.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages': ['corechart']});
        google.charts.setOnLoadCallback(getData);

        function getData() {
            const config = {
                apiKey: "AIzaSyD3DCu_y5AC3D1Qn8mczJwDxCd-Wl_7_DQ",
                authDomain: "instagram-speed-test.firebaseapp.com",
                databaseURL: "https://instagram-speed-test.firebaseio.com",
                projectId: "instagram-speed-test",
                storageBucket: "instagram-speed-test.appspot.com",
                messagingSenderId: "998820631733"
            };
            firebase.initializeApp(config);

            const db = firebase.firestore();

            const data = {};
            db.collection("times").get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    data[doc.id] = doc.data();
                });
                drawChart(data);
            });
        }

        function drawChart(timeData) {
            const tools = [
                'instamancer',
                'instaphyte',
                'instaloader',
                'instalooter',
                'instagram-scraper',
            ];

            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'DateTime');
            for (const tool of tools) {
                data.addColumn('number', tool);
            }

            Object.entries(timeData).forEach(([time, values]) => {
                const row = [];

                const d = new Date(0);
                d.setUTCSeconds(parseInt(time));
                row.push(d);

                for (const tool of tools) {
                    row.push(values[tool] > 0 ? values[tool] / 500 : null)
                }
                data.addRow(row);
            });

            var options = {
                title: 'Instagram Speed Test',
                curveType: 'function',
                legend: {position: 'bottom'},
                interpolateNulls: true,
            };

            var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

            chart.draw(data, options);
        }
    </script>
</head>
<body>
<div id="curve_chart" style="width: 100%; height: 600px"></div>
</body>
</html>
